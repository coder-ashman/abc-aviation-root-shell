<!DOCTYPE html>
<html lang="en" data-brand="A">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ABC Aviation Shell</title>
    <!-- Import map defining global modules and per‑tenant overrides -->
    <script type="importmap">
      {
        "imports": {
          "single-spa": "https://esm.sh/single-spa@6.0.1",
          "single-spa-layout": "https://esm.sh/single-spa-layout@2.0.0",
          "react": "https://cdn.skypack.dev/react@18",
          "react-dom": "https://cdn.skypack.dev/react-dom@18",
          "@owner-portal/web": "/owner-portal-web/assets/remoteEntry.js",
          "@owner-portal/native": "/owner-portal-native/index.js",
          "@crew/training": "/training-a/remoteEntry.js",
          "@crew/training-a": "/training-a/remoteEntry.js",
          "@crew/training-b": "/training-b/remoteEntry.js",
          "@maintenance/app": "/maintenance/remoteEntry.js",
          "@shared/notifications": "/parcels/notifications.js",
          "@shared/chat": "/parcels/chat.js"
        },
        "scopes": {
          "/subsidiary-b/": {
            "@crew/training": "/training-b/remoteEntry.js"
          },
          "/subsidiary-c/": {
            "@crew/training": "/training-c/remoteEntry.js"
          }
        }
      }
    </script>
    <!-- Tools for development: import‑map overrides and single‑spa inspector (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/import-map-overrides/dist/import-map-overrides.js"></script>
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        window.importMapOverrides?.enableUI();
      });
    </script>
    <!-- Root styling and theme variables loaded once -->
    <link rel="stylesheet" href="/src/theme.css" />
  </head>
  <body>
    <!-- Layout for single-spa applications and parcels -->
    <header class="shell-header">
      <div class="shell-header__brand">
        <strong>ABC Aviation</strong>
      </div>
      <nav class="shell-header__nav">
        <a href="/" data-nav-link>Owner Portal</a>
        <a href="/training/a" data-nav-link>Training A</a>
        <a href="/training/b" data-nav-link>Training B</a>
        <a href="/maintenance" data-nav-link>Maintenance</a>
      </nav>
      <div id="brand-switcher" class="shell-header__brand-switcher"></div>
      <button type="button" class="shell-header__overrides" data-open-overrides>
        Import Map Overrides
      </button>
      <button type="button" class="shell-header__reset-overrides" data-reset-overrides>
        Clear Overrides
      </button>
    </header>
    <single-spa-router>
      <main id="main-slot">
        <!-- Root route: Owner portal web -->
        <route path="/">
          <application name="@owner-portal/web"></application>
        </route>
        <!-- Training routes -->
        <route path="/training/a">
          <application name="@crew/training-a"></application>
        </route>
        <route path="/training/b">
          <application name="@crew/training-b"></application>
        </route>
        <!-- Maintenance route -->
        <route path="/maintenance">
          <application name="@maintenance/app"></application>
        </route>
      </main>
      <aside id="aside-slot">
        <!-- Parcels mount here for notifications and chat -->
        <parcel name="@shared/notifications"></parcel>
        <parcel name="@shared/chat"></parcel>
      </aside>
    </single-spa-router>
    <import-map-overrides-full
      show-when-local-storage="import-map-overrides-ui"
      trigger-position="top-right"
    ></import-map-overrides-full>
    <!-- Load the root config and start single‑spa -->
    <!-- Load environment-based configuration first, before single-spa -->
    <script src="./src/env-config.js"></script>
    <script type="module">
      import { start } from 'single-spa';
      import rootConfig from './src/root-config.js';
      import './src/brand-switcher.js';
      import './src/shell-header.js';
      rootConfig();
      start();
    </script>
  </body>
</html>
